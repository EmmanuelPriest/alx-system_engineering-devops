#!/usr/bin/env bash
# Install and configure HAproxy on your lb-01 server
# Configure HAproxy so that it send traffic to web-01 and web-02
# Distribute requests using a roundrobin algorithm
# Make sure that HAproxy can be managed via an init script

apt-get install --no-install-recommends software-properties-common
add-apt-repository ppa:vbernat/haproxy-2.6
apt-get install haproxy=2.6.\*

cat >> /etc/haproxy/haproxy.cfg << EOF
frontend  aniebue-frontend
        bind *:80
        mode http
        default_backend aniebue-backend
backend aniebue-backend
        balance roundrobin
        server 53448-web-01 54.90.13.5:80 check
        server 53448-web-02 52.87.153.233:80 check
EOF

echo "ENABLED=1" | sudo tee -a /etc/default/haproxy
service haproxy restart
